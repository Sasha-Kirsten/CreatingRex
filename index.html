<!DOCTYPE html>
<html>
<head>
    <title>Chat Box</title>
    <style>
        .chat-container {
            width: 400px;
            height: 500px;
            border: 1px solid #ccc;
            overflow: auto;
            padding: 10px;
        }
        .chat-message {
			border-radius: 5px;
			padding: 20px;
			margin: 5px 0;
			word-wrap: break-word;
			overflow-wrap: break-word;
			max-width: 80%;
			width: fit-content;
		}        
		.user {
            align-self: flex-end;
            background-color: #4caf50;
            color: white;
            justify-content: flex-end;
            margin-left: auto;
            flex-direction: row-reverse;
        }
        .assistant {
            align-self: flex-start;
            background-color: #ddd;
            justify-content: flex-start;
            margin-right: auto;
        }
        .correct-answer {
            color: green;
            background-color: #FFFFFF;
        }
        .incorrect-answer {
            color: red;
            background-color: #FFFFFF;
        }
        .conversation-container {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        #inputField {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div id="chat" class="chat-container"></div>
    <div class="input-container">
        <input type="text" id="user-input" placeholder="Enter your message">
        <button id="send-button">Send</button>
    </div>
    <div class="button-container">
        <button class="button" onclick="sendOption('I got it')">I got it</button>
        <button class="button" onclick="sendOption('Need More Examples')">Need More Examples</button>
        <button class="button" onclick="sendOption('No, Please Elaborate')">No, Please Elaborate</button>
    </div>

    <script>
        const chatContainer = document.getElementById('chat');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');

        sendButton.addEventListener('click', sendMessage);

        function sendMessage() {
            const userMessage = userInput.value.trim();
            if (userMessage !== '') {
                appendMessage('user', userMessage);
                fetchAssistantReply(userMessage);
            }
            userInput.value = '';
        }

        function appendMessage(role, content) {
			const messageElement = document.createElement('div');
			messageElement.classList.add('chat-message');
			messageElement.classList.add(role);
			chatContainer.appendChild(messageElement);
		
			if (role === 'assistant') {
				const textElement = document.createElement('span');
				messageElement.appendChild(textElement);
				typeWriterEffect(textElement, content);
				speakAssistant(content);
				
			} else {
				messageElement.textContent = content;
				updateScroll();
			}
		}		
		function typeWriterEffect(element, content) {
			const typingDelay = 50;
			const contentArray = content.split('');
			let charIndex = 0;
		
			const typeInterval = setInterval(() => {
				element.textContent += contentArray[charIndex];
				charIndex++;
				updateScroll();
		
				if (charIndex === contentArray.length) {
					clearInterval(typeInterval);
				}
			}, typingDelay);
		}

		function speakAssistant(text) {
			const utterance = new SpeechSynthesisUtterance(text);
			console.log(window.speechSynthesis.getVoices());
		//	utterance.voice = voices.filter(voice => voice.name === 'desired-voice-name')[0]; 

			utterance.rate = 0.9;
			speechSynthesis.speak(utterance);
		}

        function sendOption(option) {
            appendMessage('user', option);
            fetchAssistantReply(option);
        }
        function updateScroll() {
			const chatBox = document.getElementById('chat');
			chatBox.scrollTop = chatBox.scrollHeight;
		}

        function fetchAssistantReply(userMessage) {
            fetch('/assistant', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ userMessage })
            })
            .then(response => response.json())
            .then(data => {
                const assistantReply = data.reply;
                appendMessage('assistant', assistantReply);
            })
            .catch(error => console.error(error));
        }
    </script>
</body>
</html>
